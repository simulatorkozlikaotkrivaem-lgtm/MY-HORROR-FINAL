<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<style>
  @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

  body { margin: 0; background: #000; color: white; font-family: 'Press Start 2P', cursive; overflow: hidden; user-select: none; }
  #game-container { width: 100vw; height: 100vh; display: flex; justify-content: center; align-items: center; position: relative; }

  .screen { position: absolute; inset: 0; display: flex; flex-direction: column; justify-content: center; align-items: center; opacity: 0; visibility: hidden; transition: opacity 0.5s; }
  .active { opacity: 1; visibility: visible; }
  
  #disclaimer-screen { text-align: center; padding: 40px; }
  .disclaimer-text { font-size: 18px; line-height: 1.8; max-width: 800px; }

  .glitch { font-size: 30px; color: white; animation: glitch-anim 0.2s infinite; }
  @keyframes glitch-anim {
    0% { transform: translate(3px, -3px); text-shadow: 3px 0 red; }
    50% { transform: translate(-3px, 3px); text-shadow: -3px 0 blue; }
    100% { transform: translate(0); }
  }

  #loading-clock { position: absolute; bottom: 30px; right: 30px; font-size: 40px; }

  #main-menu { background: #000; align-items: flex-start; padding-left: 8%; font-family: 'Courier New', monospace; }
  .game-title { font-size: 60px; color: #eee; margin: 0; text-transform: uppercase; }
  .mini-update { color: gold; font-size: 20px; animation: blink 0.6s infinite; margin-bottom: 15px; }
  .menu-btn { font-size: 35px; color: #777; background: none; border: none; cursor: pointer; text-align: left; font-family: inherit; margin: 15px 0; transition: 0.2s; }
  .menu-btn:hover:not(.locked) { color: #fff; transform: scale(1.05); }
  .locked { cursor: default; opacity: 0.3; }
  @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.2; } }

  #office { background: #000; transition: background 0.5s; }
  .dust { position: absolute; background: #fff; border-radius: 50%; opacity: 0.2; pointer-events: none; animation: float 12s infinite linear; }
  @keyframes float { from { transform: translateY(-10vh); } to { transform: translateY(110vh); } }
  
  .chain { width: 4px; height: 150px; background: #222; position: absolute; top: 0; left: 50%; transform: translateX(-50%); z-index: 10; }
  .bulb { width: 35px; height: 40px; background: #fff; border-radius: 50%; position: absolute; top: 150px; left: 50%; transform: translateX(-50%); box-shadow: 0 0 60px #fff; animation: flicker 0.15s infinite alternate; z-index: 11; }
  @keyframes flicker { 0% { opacity: 0.7; } 100% { opacity: 1; } }

  .nav-zone { position: absolute; bottom: 0; width: 80px; height: 90%; border: 2px solid rgba(255, 0, 0, 0.3); display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 100; color: rgba(255, 0, 0, 0.5); font-size: 20px; }
  .nav-zone:hover { background: rgba(255, 0, 0, 0.1); border-color: red; color: red; }
  .nav-l { left: 10px; }
  .nav-r { right: 10px; }

  .gate { position: absolute; inset: 0; background: repeating-linear-gradient(90deg, #111, #111 25px, #333 27px, #111 30px); transform: translateY(-100%); transition: transform 0.4s ease-in; z-index: 60; border-bottom: 20px solid #222; }
  .gate.closed { transform: translateY(0); }
  .light-white { position: absolute; inset: 0; background: radial-gradient(circle at center, rgba(255,255,255,0.4) 0%, rgba(0,0,0,0) 75%); visibility: hidden; z-index: 70; pointer-events: none; }

  .ctrl-panel { position: absolute; right: 100px; bottom: 60px; display: flex; flex-direction: column; gap: 20px; z-index: 150; }
  .ctrl-btn { padding: 15px 25px; background: #111; border: 4px solid #333; color: #555; cursor: pointer; font-family: inherit; font-size: 12px; }
  .active-red { border-color: #f00 !important; color: #f00 !important; }
  .active-white { border-color: #fff !important; color: #fff !important; }

  #ui { position: absolute; top: 30px; left: 30px; font-size: 14px; line-height: 2; z-index: 300; pointer-events: none; color: #eee; }

  .real-eyes { display: none; gap: 40px; }
  .eye-ball { width: 15px; height: 15px; background: #fff; border-radius: 50%; box-shadow: 0 0 15px #fff; animation: blink-eyes 0.5s infinite; }
  @keyframes blink-eyes { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }

  #jumpscare { background: #000; z-index: 9999; }
  .scare-eyes-wrap { display: none; position: relative; }
  .scare-eye { position: absolute; width: 40px; height: 40px; background: red; border-radius: 50%; box-shadow: 0 0 30px red; bottom: -500px; transition: all 0.2s; }
  
  .shake { animation: shake-anim 0.1s infinite; }
  @keyframes shake-anim {
    0% { transform: translate(0,0); }
    25% { transform: translate(10px, 10px); }
    50% { transform: translate(-10px, -10px); }
    75% { transform: translate(10px, -10px); }
    100% { transform: translate(0,0); }
  }

  #win-screen { background: #000; z-index: 9000; }

  /* --- –ù–û–í–´–ï –°–¢–ò–õ–ò (–≠–ö–°–¢–†–ê, –ú–ê–°–ö–ê, –ú–ï–ù–î–û) --- */
  #mask-overlay { position: absolute; inset: 0; border: 150px solid #5d4037; border-image: radial-gradient(circle, transparent 20%, #3e2723 50%) 100; z-index: 500; display: none; pointer-events: none; }
  .mask-hole { position: absolute; width: 250px; height: 350px; border: 10px solid #222; border-radius: 40%; top: 50%; transform: translateY(-50%); background: transparent; box-shadow: 0 0 100px #000 inset; }
  
  .mendo-eyes { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); display: none; gap: 60px; z-index: 45; }
  .mendo-eye { width: 20px; height: 20px; background: #ffea00; border-radius: 50%; box-shadow: 0 0 25px #ffea00; }

  .enemy-red-eyes { position: absolute; top: 40%; left: 50%; transform: translateX(-50%); display: none; gap: 80px; z-index: 65; }
  .red-e { width: 15px; height: 15px; background: red; border-radius: 50%; box-shadow: 0 0 15px red; }

  #extra-screen { background: #000; color: white; display: none; padding: 20px; text-align: center; }
  .extra-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin: 30px auto; max-width: 800px; }
  .extra-btn { padding: 15px; background: #111; border: 2px solid #444; color: #fff; cursor: pointer; font-size: 10px; }
  .extra-btn:hover { border-color: red; }

  .modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 5px; z-index: 10000; color: black; display: none; max-width: 400px; text-align: center; }
  .modal-text { color: red; font-size: 14px; text-shadow: 0 0 5px red; margin-bottom: 20px; line-height: 1.5; }
  .close-modal { position: absolute; top: -15px; right: -15px; width: 30px; height: 30px; background: red; border-radius: 50%; border: 2px solid white; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px; }

  #flash-white { position: fixed; inset: 0; background: #fff000; z-index: 99999; opacity: 0; pointer-events: none; }
  .ver { position: absolute; bottom: 10px; left: 10px; font-size: 12px; color: #444; font-family: sans-serif; }
</style>
</head>
<body>

<div id="game-container">
  <div id="flash-white"></div>
  <div id="modal" class="modal">
    <div class="close-modal" onclick="closeModal()">√ó</div>
    <div id="modal-content" class="modal-text"></div>
  </div>

  <div id="disclaimer-screen" class="screen">
    <div class="disclaimer-text">
      –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: –í —ç—Ç–æ–π –≤–∏–¥–µ–æ –∏–≥—Ä–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ —Å—Ü–µ–Ω—ã, —Ç–∞–∫–∏–µ –∫–∞–∫ —Å–∫—Ä–∏–º–µ—Ä—ã, –º–∏–≥–∞—é—â–∏–µ –æ–≥–Ω–∏. –ò–≥—Ä–∞–π—Ç–µ –Ω–∞ —Å–≤–æ—ë–º —Ä–∏—Å–∫–µ.
    </div>
  </div>

  <div id="main-menu" class="screen">
    <div class="mini-update">–ú–∏–Ω–∏ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ</div>
    <h1 class="game-title">Stv Nights</h1>
    <button class="menu-btn" onclick="startSequence(1)">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
    <button id="btn-n2" class="menu-btn locked" onclick="startSequence(2)">2 –ù–æ—á—å</button>
    <button id="btn-extra" class="menu-btn locked" onclick="openExtra()">Extra</button>
    <div class="ver">0.1.2V ‚Äî Golden Mendo</div>
  </div>

  <div id="extra-screen" class="screen">
    <div style="width:100%; text-align:right;"><button class="menu-btn" style="font-size:20px;" onclick="closeExtra()">–ó–∞–∫—Ä—ã—Ç—å</button></div>
    <div class="extra-grid">
      <button class="extra-btn" onclick="startSequence(1)">1 –ù–æ—á—å</button>
      <button class="extra-btn" onclick="startSequence(2)">2 –ù–æ—á—å</button>
      <button class="extra-btn" onclick="openModal(1)">3 –ù–æ—á—å</button>
      <button class="extra-btn" onclick="openModal(1)">4 –ù–æ—á—å</button>
      <button class="extra-btn" onclick="openModal(1)">5 –ù–æ—á—å</button>
    </div>
    <div style="color:red; margin: 20px 0;">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ</div>
    <div class="extra-grid">
      <button class="extra-btn" onclick="openModal(1)">6 –ù–æ—á—å</button>
      <button class="extra-btn" onclick="openModal(1)">7 –ù–æ—á—å</button>
      <button class="extra-btn" style="color:red;" onclick="openModal(1)">8 –ù–æ—á—å (–ö–û–®–ú–ê–†)</button>
    </div>
    <div style="margin-top:40px; font-size:10px; opacity:0.5;">–ò–≥—Ä–∞ –°–æ–∑–¥–∞–Ω–∞ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º: @Xn1ckname</div>
    <button class="menu-btn" style="margin-top:20px; font-size:18px;" onclick="openModal(2)">Custom Night</button>
  </div>

  <div id="transition-screen" class="screen">
    <div id="msg-box"></div>
  </div>

  <div id="office" class="screen">
    <div id="mask-overlay">
        <div class="mask-hole" style="left:15%;"></div>
        <div class="mask-hole" style="right:15%;"></div>
    </div>
    <div id="ui">
      –ê–∫–∫—É–º—É–ª—è—Ç–æ—Ä ‚Äî <span id="p-val">100</span>%<br>
      –ù–æ—á—å ‚Äî <span id="n-val">1</span><br>
      –í—Ä–µ–º—è ‚Äî <span id="t-val">0:00</span>
    </div>

    <div id="view-center" class="room-view" style="width:100%; height:100%;">
      <div id="mendo" class="mendo-eyes"><div class="mendo-eye"></div><div class="mendo-eye"></div></div>
      <div class="chain"></div>
      <div class="bulb"></div>
      <div id="dust-box"></div>
      <div id="nav-l-btn" class="nav-zone nav-l" onclick="goTo('left')"> << </div>
      <div id="nav-r-btn" class="nav-zone nav-r" onclick="goTo('right')"> >> </div>
      <div id="mask-btn-panel" class="ctrl-panel" style="right:50%; transform:translateX(50%); bottom:20px; display:none;">
        <button id="b-mask" class="ctrl-btn" style="border-color:red; color:red;" onclick="toggleMask()">–ú–ê–°–ö–ê</button>
      </div>
    </div>

    <div id="view-left" class="room-view" style="display:none; width:100%; height:100%;">
      <div id="red-l" class="enemy-red-eyes"><div class="red-e"></div><div class="red-e"></div></div>
      <div id="gate-l" class="gate"></div>
      <div id="light-l" class="light-white"></div>
      <div class="nav-zone nav-r" onclick="goTo('center')"> >> </div>
      <div class="ctrl-panel">
        <button id="b-gate-l" class="ctrl-btn" onclick="toggleGate('l')">–†–µ—à—ë—Ç–∫–∞</button>
        <button id="b-light-l" class="ctrl-btn" onclick="toggleLight('l')">–ü–æ–¥—Å–≤–µ—Ç–∫–∞</button>
      </div>
    </div>

    <div id="view-right" class="room-view" style="display:none; width:100%; height:100%;">
      <div id="red-r" class="enemy-red-eyes"><div class="red-e"></div><div class="red-e"></div></div>
      <div id="gate-r" class="gate"></div>
      <div id="light-r" class="light-white"></div>
      <div class="nav-zone nav-l" onclick="goTo('center')"> << </div>
      <div class="ctrl-panel">
        <button id="b-gate-r" class="ctrl-btn" onclick="toggleGate('r')">–†–µ—à—ë—Ç–∫–∞</button>
        <button id="b-light-r" class="ctrl-btn" onclick="toggleLight('r')">–ü–æ–¥—Å–≤–µ—Ç–∫–∞</button>
      </div>
    </div>
  </div>

  <div id="power-out" class="screen">
    <div id="eyes-box" class="real-eyes">
      <div class="eye-ball"></div>
      <div class="eye-ball"></div>
    </div>
  </div>

  <div id="jumpscare" class="screen">
    <div id="scare-wrap" class="scare-eyes-wrap">
        <div class="scare-eye" style="left: -100px;"></div>
        <div class="scare-eye" style="left: 60px;"></div>
    </div>
  </div>

  <div id="win-screen" class="screen">
    <div style="font-size: 50px;">7:00</div>
    <button style="margin-top:40px; padding:10px 20px;" onclick="location.reload()">‚Üí</button>
  </div>
</div>

<script>
  let power = 100, hour = 0, isDead = false, won = false, currentNight = 1;
  let gates = { l: false, r: false }, lights = { l: false, r: false }, isMask = false;
  let audioCtx, fanOsc, scaryOsc, ringing;
  let mendoActive = false, mendoDone = false, enemyAtDoor = null, enemyTimer = null;

  window.onload = () => {
    updateMenuLocks();
    setTimeout(() => {
      document.getElementById('disclaimer-screen').classList.add('active');
      setTimeout(() => {
        document.getElementById('disclaimer-screen').classList.remove('active');
        setTimeout(() => document.getElementById('main-menu').classList.add('active'), 5000);
      }, 4000);
    }, 5000);
  };

  function updateMenuLocks() {
    if(localStorage.getItem('night1Done')) {
      document.getElementById('btn-n2').classList.remove('locked');
    }
    if(localStorage.getItem('night2Done')) {
      document.getElementById('btn-extra').classList.remove('locked');
    }
  }

  function startSequence(n) {
    if(n === 2 && !localStorage.getItem('night1Done')) return;
    currentNight = n;
    document.getElementById('main-menu').classList.remove('active');
    document.getElementById('extra-screen').classList.remove('active');
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    setTimeout(() => {
      showMsg(`<div class="glitch">${n} –ù–æ—á—å</div>`, 4000, () => {
        setTimeout(() => {
          showMsg('<div id="loading-clock">üïí</div>', 5000, () => setTimeout(initOffice, 2000));
        }, 2000);
      });
    }, 500);
  }

  function initOffice() {
    isDead = false; won = false; power = 100; hour = 0; mendoDone = false;
    document.getElementById('n-val').innerText = currentNight;
    document.getElementById('office').classList.add('active');
    document.getElementById('office').style.background = '#000';
    if(currentNight === 2) document.getElementById('mask-btn-panel').style.display = 'flex';
    startFan();
    runGameLogic();
    for(let i=0; i<30; i++) {
      let d = document.createElement('div'); d.className='dust';
      d.style.width = d.style.height = Math.random()*4+'px';
      d.style.left = Math.random()*100+'%'; d.style.top = Math.random()*100+'%';
      document.getElementById('dust-box').appendChild(d);
    }
  }

  function startFan() {
    fanOsc = audioCtx.createOscillator();
    let g = audioCtx.createGain();
    fanOsc.type = 'square'; fanOsc.frequency.value = 35;
    g.gain.value = 0.01;
    fanOsc.connect(g); g.connect(audioCtx.destination);
    fanOsc.start();
  }

  function goTo(room) {
    if(isDead || won || isMask) return;
    document.querySelectorAll('.room-view').forEach(v => v.style.display = 'none');
    document.getElementById('view-' + room).style.display = 'block';
  }

  function toggleGate(s) {
    if(isDead || power <= 0 || isMask) return;
    gates[s] = !gates[s];
    document.getElementById('gate-'+s).classList.toggle('closed', gates[s]);
    document.getElementById('b-gate-'+s).classList.toggle('active-red', gates[s]);
  }

  function toggleLight(s) {
    if(isDead || power <= 0 || isMask) return;
    lights.l = (s === 'l' && !lights.l);
    lights.r = (s === 'r' && !lights.r);
    document.getElementById('light-l').style.visibility = lights.l ? 'visible' : 'hidden';
    document.getElementById('light-r').style.visibility = lights.r ? 'visible' : 'hidden';
    document.getElementById('red-l').style.display = (lights.l && enemyAtDoor === 'l') ? 'flex' : 'none';
    document.getElementById('red-r').style.display = (lights.r && enemyAtDoor === 'r') ? 'flex' : 'none';
    document.getElementById('b-light-l').classList.toggle('active-white', lights.l);
    document.getElementById('b-light-r').classList.toggle('active-white', lights.r);
  }

  function toggleMask() {
    if(isDead || power <= 0) return;
    isMask = !isMask;
    document.getElementById('mask-overlay').style.display = isMask ? 'block' : 'none';
    document.getElementById('nav-l-btn').style.display = isMask ? 'none' : 'flex';
    document.getElementById('nav-r-btn').style.display = isMask ? 'none' : 'flex';
    if(isMask && mendoActive) {
      mendoActive = false;
      document.getElementById('mendo').style.display = 'none';
    }
  }

  function runGameLogic() {
    const hTimer = setInterval(() => {
      if(isDead || won) return clearInterval(hTimer);
      hour++;
      document.getElementById('t-val').innerText = hour + ":00";
      if(hour >= 7) triggerWin();
    }, 35000);

    const pTimer = setInterval(() => {
      if(isDead || won || power <= 0) return clearInterval(pTimer);
      let gCount = (gates.l?1:0) + (gates.r?1:0);
      power -= (0.1 + (gCount * 0.2) + (isMask?0.1:0));
      document.getElementById('p-val').innerText = Math.max(0, Math.floor(power));
      if(power <= 0) triggerPowerOut();

      // –®–∞–Ω—Å—ã –ø–æ—è–≤–ª–µ–Ω–∏—è –ö—Ä–∞—Å–Ω–æ–≥–ª–∞–∑–æ–≥–æ
      let chance = (currentNight === 1) ? 0.35 : 0.49;
      if(!enemyAtDoor && Math.random() < chance / 10) spawnEnemy();

      // –®–∞–Ω—Å –ú–µ–Ω–¥–æ –≤–æ 2 –Ω–æ—á–∏
      if(currentNight === 2 && !mendoActive && !mendoDone && Math.random() < 0.15 / 10) spawnMendo();
    }, 1000);
  }

  function spawnEnemy() {
    if(mendoActive) return;
    enemyAtDoor = Math.random() < 0.5 ? 'l' : 'r';
    enemyTimer = setTimeout(() => {
      if(!gates[enemyAtDoor]) triggerScreamer();
      else { enemyAtDoor = null; }
    }, 3000);
  }

  function spawnMendo() {
    mendoActive = true;
    document.getElementById('mendo').style.display = 'flex';
    setTimeout(() => {
      if(mendoActive && !isMask) triggerMendoEffect();
      else { mendoActive = false; mendoDone = true; document.getElementById('mendo').style.display = 'none'; }
    }, 2000);
  }

  function triggerMendoEffect() {
    mendoActive = false; mendoDone = true;
    document.getElementById('mendo').style.display = 'none';
    power -= 45;
    document.getElementById('flash-white').style.opacity = '1';
    let ring = audioCtx.createOscillator();
    ring.frequency.value = 3000; ring.connect(audioCtx.destination); ring.start();
    setTimeout(() => {
      document.getElementById('flash-white').style.opacity = '0';
      document.getElementById('office').style.background = '#221a00';
      ring.stop();
    }, 4000);
  }

  function triggerWin() {
    won = true; if(fanOsc) fanOsc.stop();
    if(currentNight === 1) localStorage.setItem('night1Done', true);
    if(currentNight === 2) localStorage.setItem('night2Done', true);
    updateMenuLocks();
    document.getElementById('office').classList.remove('active');
    document.getElementById('win-screen').classList.add('active');
  }

  function triggerPowerOut() {
    isDead = true; if(fanOsc) fanOsc.stop();
    document.getElementById('office').classList.remove('active');
    document.getElementById('power-out').classList.add('active');
    setTimeout(() => {
      document.getElementById('eyes-box').style.display = 'flex';
      scaryOsc = audioCtx.createOscillator(); scaryOsc.type='sawtooth'; scaryOsc.frequency.value=60;
      let sg = audioCtx.createGain(); sg.gain.value=0.05; scaryOsc.connect(sg); sg.connect(audioCtx.destination); scaryOsc.start();
      setTimeout(() => {
        if(scaryOsc) scaryOsc.stop();
        document.getElementById('power-out').classList.remove('active');
        setTimeout(triggerScreamer, 5000);
      }, 7000);
    }, 4000);
  }

  function triggerScreamer() {
    isDead = true;
    document.getElementById('jumpscare').classList.add('active');
    document.body.classList.add('shake');
    document.getElementById('scare-wrap').style.display = 'block';
    let scream = audioCtx.createOscillator(); scream.type='sawtooth'; scream.frequency.setValueAtTime(100, audioCtx.currentTime);
    scream.frequency.exponentialRampToValueAtTime(800, audioCtx.currentTime + 0.1);
    let sg = audioCtx.createGain(); sg.gain.value=0.2; scream.connect(sg); sg.connect(audioCtx.destination); scre
